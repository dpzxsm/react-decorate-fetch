{"version":3,"sources":["../../src/connect/helper.js"],"names":["defaults","fetchOptions","method","headers","buildResponse","res","json","then","dataOrError","ok","fetchInitKeys","omitChildren","obj","children","rest","buildQuery","params","esc","encodeURIComponent","Object","keys","map","Array","isArray","k","key","items","item","join","filterOptions","options","reduce","data","indexOf","buildFetch","url","topFetch","window","fetch","bind","global","self","otherOptions","host","match","assign","globalParams","buildParams","query","body","JSON","stringify","initConfig","mapResponse","Function","prototype","isPrototypeOf","bindDomClick","func","verification","event","currentTarget","dataset"],"mappings":"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","file":"helper.js","sourcesContent":["const defaults = {\n  fetchOptions: {\n    method: 'GET',\n    headers: {\n      'Accept': 'application/json',\n      'Content-Type': 'application/json'\n    }\n  },\n  buildResponse: function (res) {\n    if (res && res.json) {\n      return res.json().then((dataOrError) => {\n        if (res.ok) {\n          return dataOrError;\n        } else {\n          throw dataOrError;\n        }\n      });\n    } else {\n      return {};\n    }\n  }\n};\n\nconst fetchInitKeys = ['method', 'headers', 'body', 'mode', 'credentials', 'cache', 'redirect', 'referrer', 'referrerPolicy', 'integrity'];\n\nfunction omitChildren(obj) {\n  const { children, ...rest } = obj;\n  return rest;\n}\n\nfunction buildQuery(params) {\n  let esc = encodeURIComponent;\n  return Object.keys(params)\n    .map(k => {\n      if (Array.isArray(params[k])) {\n        let key = k;\n        let items = params[k].map(item => {\n          return esc(key + '[]') + '=' + esc(item);\n        });\n        return items.join('&');\n      } else {\n        return esc(k) + '=' + esc(params[k]);\n      }\n    })\n    .join('&');\n}\n\nfunction filterOptions(options) {\n  return Object.keys(options).reduce((data, key) => {\n    if (fetchInitKeys.indexOf(key) !== -1) {\n      data[key] = options[key];\n    }\n    return data;\n  }, {});\n}\n\nfunction buildFetch(url, options = {}) {\n  let topFetch;\n  if (typeof window !== 'undefined') {\n    if (window.fetch) {\n      topFetch = window.fetch.bind(window);\n    }\n  } else if (typeof global !== 'undefined') {\n    if (global.fetch) {\n      topFetch = global.fetch.bind(global);\n    }\n  } else if (typeof self !== 'undefined') {\n    if (self.fetch) {\n      topFetch = self.fetch.bind(self);\n    }\n  }\n  let { params = {}, ...otherOptions } = options;\n  otherOptions = filterOptions(otherOptions);\n  let { host, ...fetchOptions } = defaults.fetchOptions;\n  if (!url.match(/https?:\\/\\//) && host) {\n    url = host + url;\n  }\n  otherOptions.headers = Object.assign({}, options.headers || {}, fetchOptions.headers);\n  otherOptions.method = options.method || fetchOptions.method;\n  let globalParams = fetchOptions.buildParams ? fetchOptions.buildParams() : {};\n  params = Object.assign({}, params, globalParams);\n  if (otherOptions.method === 'GET') {\n    let query = buildQuery(params);\n    if (query) {\n      if (url.match(/https?:\\/\\/.*\\?/)) {\n        url = url + '&' + buildQuery(params);\n      } else {\n        url = url + '?' + buildQuery(params);\n      }\n    }\n  } else if (otherOptions.method === 'POST') {\n    otherOptions.body = JSON.stringify(params);\n  }\n  return fetch(url, otherOptions).then((res) => {\n    return defaults.buildResponse(res);\n  });\n}\n\nfunction initConfig({ options = {}, mapResponse }) {\n  if (typeof options === 'object') {\n    defaults.fetchOptions = Object.assign(defaults.fetchOptions, options);\n  }\n  if (Function.prototype.isPrototypeOf(mapResponse)) {\n    defaults.buildResponse = mapResponse;\n  }\n}\n\nfunction bindDomClick(func, verification) {\n  return function (event) {\n    // get params from event\n    let params = {};\n    if (event && event.currentTarget) {\n      let dataset = event.currentTarget.dataset || {};\n      params = {\n        ...dataset\n      };\n    }\n    if (verification) {\n      if (typeof verification === 'function') {\n        if (!verification(params)) return;\n      } else {\n        return;\n      }\n    }\n    return func(params);\n  };\n}\n\nexport {\n  omitChildren,\n  buildFetch,\n  initConfig,\n  bindDomClick\n};"]}