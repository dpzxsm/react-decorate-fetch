{"version":3,"sources":["../../src/utils/mapRequest.js"],"names":["makeRequest","options","params","url","value","delay","then","andThen","successText","otherOptions","Promise","resolve","reject","request","Function","prototype","isPrototypeOf","result","thenOptions","mapRequestByOptions","data","status","loading","error","success","code","message","toString","setTimeout","defaults","method","Array","isArray","all","map","item"],"mappings":"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","sourcesContent":["import { compose } from \"./middleware.js\";\nimport { buildFetch } from \"./helper.js\";\nimport isPlainObject from \"./isPlainObject.js\";\n\nfunction makeRequest(options = {}) {\n  return function (params = {}) {\n    let { url, value, delay = 0, then, andThen, successText, ...otherOptions } = options;\n    // support modify params\n    if (otherOptions.params) {\n      otherOptions.params = {\n        ...otherOptions.params,\n        ...params\n      };\n    } else {\n      otherOptions.params = params;\n    }\n    return new Promise((resolve, reject) => {\n      compose('before')([options], () => {\n        let request;\n        if (value && !Function.prototype.isPrototypeOf(value)) {\n          request = Promise.resolve(value);\n        } else if (url) {\n          request = buildFetch(url, otherOptions);\n        } else {\n          request = Promise.reject('Must have url or value !');\n        }\n        request.then((result) => {\n          if (then) {\n            let thenOptions = then(result);\n            if (thenOptions) {\n              return mapRequestByOptions(thenOptions)();\n            }\n          }\n          let data = result;\n          if (Function.prototype.isPrototypeOf(value)) {\n            data = value(data);\n          }\n          return {\n            status: 'success',\n            loading: false,\n            error: false,\n            success: true,\n            code: 200,\n            message: successText || 'Success',\n            value: data\n          };\n        }).catch((error) => {\n          return {\n            status: 'error',\n            loading: false,\n            error: true,\n            success: false,\n            code: error.code || 0,\n            message: typeof error === 'string' ? error : (error.message || error.toString()),\n            value: null\n          };\n        }).then((data) => {\n          compose('after')([options, data], () => {\n            setTimeout(() => {\n              if (data.success) {\n                resolve(data);\n              } else {\n                reject(data);\n              }\n            }, delay);\n          });\n        });\n      });\n    });\n  };\n}\n\nfunction mapRequestByOptions(options, defaults = {}) {\n  if (typeof options === \"string\") {\n    return makeRequest({\n      ...defaults,\n      url: options,\n      method: 'GET'\n    });\n  } else if (isPlainObject(options)) {\n    return makeRequest({\n      ...defaults,\n      ...options\n    });\n  } else if (Array.isArray(options)) {\n    return () => Promise.all(options.map(item => makeRequest({\n      ...defaults,\n      ...item\n    })()));\n  } else {\n    return () => Promise.reject(\"Not Support the Request Type\");\n  }\n}\n\nexport {\n  mapRequestByOptions\n};\n"],"file":"mapRequest.js"}