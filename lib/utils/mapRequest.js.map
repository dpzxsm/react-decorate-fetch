{"version":3,"sources":["../../src/utils/mapRequest.js"],"names":["makeRequest","options","params","defaultOptions","defaults","fetchOptions","url","then","andThen","value","delay","successText","otherOptions","request","promise","Promise","resolve","reject","Function","prototype","isPrototypeOf","result","thenOptions","mapRequestByOptions","data","status","loading","error","success","code","message","cancel","toString","setTimeout","console","method","Array","isArray","all","map","item"],"mappings":"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","sourcesContent":["import { compose } from './middleware.js';\nimport { defaults, buildFetch } from './helper.js';\nimport isPlainObject from './isPlainObject.js';\n\nfunction makeRequest(options = {}) {\n  return function (params = {}) {\n    const defaultOptions = defaults.fetchOptions || {};\n    let {\n      url, then, andThen,\n      value = defaultOptions.value, delay = defaultOptions.delay, successText = defaultOptions.successText,\n      ...otherOptions\n    } = options;\n    // support modify params\n    if (otherOptions.params) {\n      otherOptions.params = {\n        ...otherOptions.params,\n        ...params\n      };\n    } else {\n      otherOptions.params = params;\n    }\n    let request = {};\n    let promise = new Promise(function (resolve, reject) {\n      compose('before')([options], () => {\n        if (value && !Function.prototype.isPrototypeOf(value)) {\n          request.promise = Promise.resolve(value);\n        } else if (url) {\n          request = buildFetch(url, otherOptions);\n        } else {\n          request.promise = Promise.reject('Must have url or value !');\n        }\n        request.promise.then((result) => {\n          if (then) {\n            let thenOptions = then(result);\n            if (thenOptions) {\n              return mapRequestByOptions(thenOptions)();\n            }\n          }\n          let data = result;\n          if (Function.prototype.isPrototypeOf(value)) {\n            data = value(data);\n          }\n          return {\n            status: 'success',\n            loading: false,\n            error: false,\n            success: true,\n            code: 200,\n            message: successText || 'Success',\n            value: data,\n            cancel:() =>{}\n          };\n        }).catch((error) => {\n          return {\n            status: 'error',\n            loading: false,\n            error: true,\n            success: false,\n            code: error.code || 0,\n            message: typeof error === 'string' ? error : (error.message || error.toString()),\n            cancel:() =>{}\n          };\n        }).then((data) => {\n          setTimeout(() => {\n            compose('after')([options, data], () => {\n              if (data.success) {\n                resolve(data);\n              } else {\n                reject(data);\n              }\n            });\n          }, delay)\n        });\n      });\n    });\n    promise.cancel = function () {\n      console.error('Request has be cancel !');\n      request.cancel && request.cancel();\n    };\n    return promise;\n  };\n}\n\nfunction mapRequestByOptions(options, defaults = {}) {\n  if (typeof options === 'string') {\n    return makeRequest({\n      ...defaults,\n      url: options,\n      method: 'GET'\n    });\n  } else if (isPlainObject(options)) {\n    return makeRequest({\n      ...defaults,\n      ...options\n    });\n  } else if (Array.isArray(options)) {\n    return () => Promise.all(options.map(item => makeRequest({\n      ...defaults,\n      ...item\n    })()));\n  } else {\n    return () => Promise.reject('Not Support the Request Type');\n  }\n}\n\nexport {\n  mapRequestByOptions\n};\n"],"file":"mapRequest.js"}