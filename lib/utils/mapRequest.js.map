{"version":3,"sources":["../../src/utils/mapRequest.js"],"names":["makeRequest","options","url","value","then","andThen","successText","otherOptions","Promise","resolve","request","Function","prototype","isPrototypeOf","reject","result","mapRequestByOptions","data","status","loading","error","success","code","message","method","Array","isArray","all","map","item"],"mappings":"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","sourcesContent":["import { compose } from \"./middleware.js\";\nimport { buildFetch } from \"./helper.js\";\nimport isPlainObject from \"./isPlainObject.js\";\n\nfunction makeRequest(options = {}) {\n  return function () {\n    let { url, value, then, andThen, successText, ...otherOptions } = options;\n    return new Promise((resolve) => {\n      compose('before')([options], () => {\n        let request;\n        if (value && !Function.prototype.isPrototypeOf(value)) {\n          request = Promise.resolve(value);\n        } else if (url) {\n          request = buildFetch(url, otherOptions);\n        } else {\n          request = Promise.reject('Must have url or value !');\n        }\n        request.then((result) => {\n          if (then) {\n            return mapRequestByOptions(then(result))();\n          }\n          let data = result;\n          if (Function.prototype.isPrototypeOf(value)) {\n            data = value(data);\n          }\n          return {\n            status: 'success',\n            loading: false,\n            error: false,\n            success: true,\n            code: 200,\n            message: successText || '请求成功',\n            value: data\n          };\n        }).catch((error) => {\n          return {\n            status: 'error',\n            loading: false,\n            error: true,\n            success: false,\n            code: error.code || 0,\n            message: error.message,\n            value: null\n          };\n        }).then((data) => {\n          compose('after')([options, data], () => {\n            resolve(data);\n          });\n        });\n      });\n    });\n  };\n}\n\nfunction mapRequestByOptions(options) {\n  if (typeof options === \"string\") {\n    return makeRequest({\n      url: options,\n      method: 'GET'\n    });\n  } else if (isPlainObject(options)) {\n    return makeRequest({ ...options });\n  } else if (Array.isArray(options)) {\n    return () => Promise.all(options.map(item => makeRequest(item)()));\n  } else {\n    return () => Promise.reject(\"Not Support the Request Type\");\n  }\n}\n\nexport {\n  mapRequestByOptions\n};\n"],"file":"mapRequest.js"}