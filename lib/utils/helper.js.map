{"version":3,"sources":["../../src/utils/helper.js"],"names":["defaults","fetchOptions","method","headers","buildResponse","res","json","then","dataOrError","ok","fetch","getTopFetch","fetchInitKeys","omitChildren","obj","children","rest","buildQuery","params","esc","encodeURIComponent","Object","keys","map","k","Array","isArray","key","items","item","join","filterOptions","options","reduce","data","indexOf","topFetch","window","bind","global","self","buildFetch","url","postFormParams","finalOptions","host","globalParams","match","assign","query","body","transformFormData","formData","FormData","forEach","append","JSON","stringify","initConfig","Function","prototype","isPrototypeOf","console","log"],"mappings":";;;;;;;;;;;;;;;AAAA,IAAMA,QAAQ,GAAG;AACfC,EAAAA,YAAY,EAAE;AACZC,IAAAA,MAAM,EAAE,KADI;AAEZC,IAAAA,OAAO,EAAE;AACP,gBAAU,kBADH;AAEP,sBAAgB;AAFT;AAFG,GADC;AAQfC,EAAAA,aAAa,EAAE,uBAAUC,GAAV,EAAe;AAC5B,QAAIA,GAAG,IAAIA,GAAG,CAACC,IAAf,EAAqB;AACnB,aAAOD,GAAG,CAACC,IAAJ,GAAWC,IAAX,CAAgB,UAACC,WAAD,EAAiB;AACtC,YAAIH,GAAG,CAACI,EAAR,EAAY;AACV,iBAAOD,WAAP;AACD,SAFD,MAEO;AACL,gBAAMA,WAAN;AACD;AACF,OANM,CAAP;AAOD,KARD,MAQO;AACL,aAAO,EAAP;AACD;AACF,GApBc;AAqBfE,EAAAA,KAAK,EAAEC,WAAW;AArBH,CAAjB;AAwBA,IAAMC,aAAa,GAAG,CAAC,QAAD,EAAW,SAAX,EAAsB,MAAtB,EAA8B,MAA9B,EAAsC,aAAtC,EAAqD,OAArD,EAA8D,UAA9D,EAA0E,UAA1E,EAAsF,gBAAtF,EAAwG,WAAxG,CAAtB;;AAEA,SAASC,YAAT,CAAsBC,GAAtB,EAA2B;AAAA,MACjBC,QADiB,GACKD,GADL,CACjBC,QADiB;AAAA,MACJC,IADI,4BACKF,GADL;;AAEzB,SAAOE,IAAP;AACD;;AAED,SAASC,UAAT,CAAoBC,MAApB,EAA4B;AAC1B,MAAIC,GAAG,GAAGC,kBAAV;AACA,SAAOC,MAAM,CAACC,IAAP,CAAYJ,MAAZ,EACJK,GADI,CACA,UAAAC,CAAC,EAAI;AACR,QAAIC,KAAK,CAACC,OAAN,CAAcR,MAAM,CAACM,CAAD,CAApB,CAAJ,EAA8B;AAC5B,UAAIG,GAAG,GAAGH,CAAV;AACA,UAAII,KAAK,GAAGV,MAAM,CAACM,CAAD,CAAN,CAAUD,GAAV,CAAc,UAAAM,IAAI,EAAI;AAChC,eAAOV,GAAG,CAACQ,GAAG,GAAG,IAAP,CAAH,GAAkB,GAAlB,GAAwBR,GAAG,CAACU,IAAD,CAAlC;AACD,OAFW,CAAZ;AAGA,aAAOD,KAAK,CAACE,IAAN,CAAW,GAAX,CAAP;AACD,KAND,MAMO;AACL,aAAOX,GAAG,CAACK,CAAD,CAAH,GAAS,GAAT,GAAeL,GAAG,CAACD,MAAM,CAACM,CAAD,CAAP,CAAzB;AACD;AACF,GAXI,EAYJM,IAZI,CAYC,GAZD,CAAP;AAaD;;AAED,SAASC,aAAT,CAAuBC,OAAvB,EAAgC;AAC9B,SAAOX,MAAM,CAACC,IAAP,CAAYU,OAAZ,EAAqBC,MAArB,CAA4B,UAACC,IAAD,EAAOP,GAAP,EAAe;AAChD,QAAIf,aAAa,CAACuB,OAAd,CAAsBR,GAAtB,MAA+B,CAAC,CAApC,EAAuC;AACrCO,MAAAA,IAAI,CAACP,GAAD,CAAJ,GAAYK,OAAO,CAACL,GAAD,CAAnB;AACD;;AACD,WAAOO,IAAP;AACD,GALM,EAKJ,EALI,CAAP;AAMD;;AAED,SAASvB,WAAT,GAAuB;AACrB,MAAIyB,QAAJ;;AACA,MAAI,OAAOC,MAAP,KAAkB,WAAtB,EAAmC;AACjC,QAAIA,MAAM,CAAC3B,KAAX,EAAkB;AAChB0B,MAAAA,QAAQ,GAAGC,MAAM,CAAC3B,KAAP,CAAa4B,IAAb,CAAkBD,MAAlB,CAAX;AACD;AACF,GAJD,MAIO,IAAI,OAAOE,MAAP,KAAkB,WAAtB,EAAmC;AACxC,QAAIA,MAAM,CAAC7B,KAAX,EAAkB;AAChB0B,MAAAA,QAAQ,GAAGG,MAAM,CAAC7B,KAAP,CAAa4B,IAAb,CAAkBC,MAAlB,CAAX;AACD;AACF,GAJM,MAIA,IAAI,OAAOC,IAAP,KAAgB,WAApB,EAAiC;AACtC,QAAIA,IAAI,CAAC9B,KAAT,EAAgB;AACd0B,MAAAA,QAAQ,GAAGI,IAAI,CAAC9B,KAAL,CAAW4B,IAAX,CAAgBE,IAAhB,CAAX;AACD;AACF;;AACD,SAAOJ,QAAP;AACD;;AAED,SAASK,UAAT,CAAoBC,GAApB,EAAuC;AAAA,MAAdV,OAAc,uEAAJ,EAAI;;AACrC;AADqC,wBAEkBA,OAFlB,CAE/Bd,MAF+B;AAAA,MAE/BA,MAF+B,gCAEtB,EAFsB;AAAA,MAElByB,cAFkB,GAEkBX,OAFlB,CAElBW,cAFkB;AAAA,MAECC,YAFD,4BAEkBZ,OAFlB;;AAGrCY,EAAAA,YAAY,GAAGb,aAAa,CAACa,YAAD,CAA5B,CAHqC,CAIrC;;AAJqC,8BAKc5C,QAAQ,CAACC,YALvB;AAAA,MAK/B4C,IAL+B,yBAK/BA,IAL+B;AAAA,qDAKzBC,YALyB;AAAA,MAKzBA,YALyB,uCAKV,EALU;AAAA,MAKH7C,YALG;;AAMrC,MAAI,CAACyC,GAAG,CAACK,KAAJ,CAAU,aAAV,CAAD,IAA6BF,IAAjC,EAAuC;AACrCH,IAAAA,GAAG,GAAGG,IAAI,GAAGH,GAAb;AACD,GARoC,CASrC;;;AACAE,EAAAA,YAAY,CAACzC,OAAb,GAAuBkB,MAAM,CAAC2B,MAAP,CAAc,EAAd,EAAkBJ,YAAY,CAACzC,OAAb,IAAwB,EAA1C,EAA8CF,YAAY,CAACE,OAA3D,CAAvB,CAVqC,CAWrC;;AACAyC,EAAAA,YAAY,GAAGvB,MAAM,CAAC2B,MAAP,CAAc/C,YAAd,EAA4B2C,YAA5B,CAAf;AAEA1B,EAAAA,MAAM,GAAGG,MAAM,CAAC2B,MAAP,CAAc,EAAd,EAAkBF,YAAlB,EAAgC5B,MAAhC,CAAT;;AACA,MAAI0B,YAAY,CAAC1C,MAAb,KAAwB,KAA5B,EAAmC;AACjC,QAAI+C,KAAK,GAAGhC,UAAU,CAACC,MAAD,CAAtB;;AACA,QAAI+B,KAAJ,EAAW;AACT,UAAIP,GAAG,CAACK,KAAJ,CAAU,iBAAV,CAAJ,EAAkC;AAChCL,QAAAA,GAAG,GAAGA,GAAG,GAAG,GAAN,GAAYzB,UAAU,CAACC,MAAD,CAA5B;AACD,OAFD,MAEO;AACLwB,QAAAA,GAAG,GAAGA,GAAG,GAAG,GAAN,GAAYzB,UAAU,CAACC,MAAD,CAA5B;AACD;AACF;AACF,GATD,MASO,IAAI0B,YAAY,CAAC1C,MAAb,KAAwB,MAAxB,IAAkC,CAAC0C,YAAY,CAACM,IAApD,EAA0D;AAC/D,QAAIN,YAAY,CAACO,iBAAjB,EACE,IAAIR,cAAJ,EAAoB;AAClB,UAAIS,QAAQ,GAAG,IAAIC,QAAJ,EAAf;AACAhC,MAAAA,MAAM,CAACC,IAAP,CAAYJ,MAAZ,EAAoBoC,OAApB,CAA4B,UAAA3B,GAAG,EAAI;AACjCyB,QAAAA,QAAQ,CAACG,MAAT,CAAgB5B,GAAhB,EAAqBT,MAAM,CAACS,GAAD,CAA3B;AACD,OAFD;AAGAiB,MAAAA,YAAY,CAACM,IAAb,GAAoBE,QAApB;AACD,KAND,MAMO;AACL;AACAR,MAAAA,YAAY,CAACM,IAAb,GAAoBM,IAAI,CAACC,SAAL,CAAevC,MAAf,CAApB;AACD;AACJ;;AACD,MAAIkB,QAAQ,GAAGpC,QAAQ,CAACU,KAAT,IAAkBC,WAAW,EAA5C;AACA,SAAOyB,QAAQ,CAACM,GAAD,EAAME,YAAN,CAAR,CAA4BrC,IAA5B,CAAiC,UAACF,GAAD,EAAS;AAC/C,WAAOL,QAAQ,CAACI,aAAT,CAAuBC,GAAvB,CAAP;AACD,GAFM,CAAP;AAGD;;AAED,SAASqD,UAAT,OAAiE;AAAA,+BAA3CzD,YAA2C;AAAA,MAA3CA,YAA2C,kCAA5B,EAA4B;AAAA,MAAxBG,aAAwB,QAAxBA,aAAwB;AAAA,MAATM,KAAS,QAATA,KAAS;;AAC/D,MAAI,QAAOT,YAAP,MAAwB,QAA5B,EAAsC;AACpCD,IAAAA,QAAQ,CAACC,YAAT,GAAwBoB,MAAM,CAAC2B,MAAP,CAAchD,QAAQ,CAACC,YAAvB,EAAqCA,YAArC,CAAxB;AACD;;AACD,MAAI0D,QAAQ,CAACC,SAAT,CAAmBC,aAAnB,CAAiCzD,aAAjC,CAAJ,EAAqD;AACnDJ,IAAAA,QAAQ,CAACI,aAAT,GAAyBA,aAAzB;AACD;;AACD,MAAIM,KAAJ,EAAW;AACToD,IAAAA,OAAO,CAACC,GAAR,CAAY,4BAAZ;AACA/D,IAAAA,QAAQ,CAACU,KAAT,GAAiBA,KAAjB;AACD;AACF","sourcesContent":["const defaults = {\n  fetchOptions: {\n    method: 'GET',\n    headers: {\n      'Accept': 'application/json',\n      'Content-Type': 'application/json'\n    }\n  },\n  buildResponse: function (res) {\n    if (res && res.json) {\n      return res.json().then((dataOrError) => {\n        if (res.ok) {\n          return dataOrError;\n        } else {\n          throw dataOrError;\n        }\n      });\n    } else {\n      return {};\n    }\n  },\n  fetch: getTopFetch()\n};\n\nconst fetchInitKeys = ['method', 'headers', 'body', 'mode', 'credentials', 'cache', 'redirect', 'referrer', 'referrerPolicy', 'integrity'];\n\nfunction omitChildren(obj) {\n  const { children, ...rest } = obj;\n  return rest;\n}\n\nfunction buildQuery(params) {\n  let esc = encodeURIComponent;\n  return Object.keys(params)\n    .map(k => {\n      if (Array.isArray(params[k])) {\n        let key = k;\n        let items = params[k].map(item => {\n          return esc(key + '[]') + '=' + esc(item);\n        });\n        return items.join('&');\n      } else {\n        return esc(k) + '=' + esc(params[k]);\n      }\n    })\n    .join('&');\n}\n\nfunction filterOptions(options) {\n  return Object.keys(options).reduce((data, key) => {\n    if (fetchInitKeys.indexOf(key) !== -1) {\n      data[key] = options[key];\n    }\n    return data;\n  }, {});\n}\n\nfunction getTopFetch() {\n  let topFetch;\n  if (typeof window !== 'undefined') {\n    if (window.fetch) {\n      topFetch = window.fetch.bind(window);\n    }\n  } else if (typeof global !== 'undefined') {\n    if (global.fetch) {\n      topFetch = global.fetch.bind(global);\n    }\n  } else if (typeof self !== 'undefined') {\n    if (self.fetch) {\n      topFetch = self.fetch.bind(self);\n    }\n  }\n  return topFetch;\n}\n\nfunction buildFetch(url, options = {}) {\n  // filter params and postFormParams\n  let { params = {}, postFormParams, ...finalOptions } = options;\n  finalOptions = filterOptions(finalOptions);\n  // filter host and globalParam\n  let { host, globalParams = {}, ...fetchOptions } = defaults.fetchOptions;\n  if (!url.match(/https?:\\/\\//) && host) {\n    url = host + url;\n  }\n  // header is special merge\n  finalOptions.headers = Object.assign({}, finalOptions.headers || {}, fetchOptions.headers);\n  // merge options\n  finalOptions = Object.assign(fetchOptions, finalOptions);\n\n  params = Object.assign({}, globalParams, params);\n  if (finalOptions.method === 'GET') {\n    let query = buildQuery(params);\n    if (query) {\n      if (url.match(/https?:\\/\\/.*\\?/)) {\n        url = url + '&' + buildQuery(params);\n      } else {\n        url = url + '?' + buildQuery(params);\n      }\n    }\n  } else if (finalOptions.method === 'POST' && !finalOptions.body) {\n    if (finalOptions.transformFormData)\n      if (postFormParams) {\n        let formData = new FormData();\n        Object.keys(params).forEach(key => {\n          formData.append(key, params[key]);\n        });\n        finalOptions.body = formData;\n      } else {\n        // default transform json\n        finalOptions.body = JSON.stringify(params);\n      }\n  }\n  let topFetch = defaults.fetch || getTopFetch();\n  return topFetch(url, finalOptions).then((res) => {\n    return defaults.buildResponse(res);\n  });\n}\n\nfunction initConfig({ fetchOptions = {}, buildResponse, fetch }) {\n  if (typeof fetchOptions === 'object') {\n    defaults.fetchOptions = Object.assign(defaults.fetchOptions, fetchOptions);\n  }\n  if (Function.prototype.isPrototypeOf(buildResponse)) {\n    defaults.buildResponse = buildResponse;\n  }\n  if (fetch) {\n    console.log('global fetch api is change');\n    defaults.fetch = fetch;\n  }\n}\n\nexport {\n  omitChildren,\n  buildFetch,\n  initConfig\n};\n"],"file":"helper.js"}