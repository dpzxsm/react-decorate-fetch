{"version":3,"sources":["../../src/utils/helper.js"],"names":["defaults","fetchOptions","method","headers","buildResponse","res","json","then","dataOrError","ok","fetchInitKeys","omitChildren","obj","children","rest","buildQuery","params","esc","encodeURIComponent","Object","keys","map","k","Array","isArray","key","items","item","join","filterOptions","options","reduce","data","indexOf","getTopFetch","topFetch","window","fetch","bind","global","self","buildFetch","url","isForm","otherOptions","host","match","assign","globalParams","query","body","transformFormData","formData","FormData","forEach","append","JSON","stringify","initConfig","mapResponse","Function","prototype","isPrototypeOf","bindDomClick","func","verification","event","currentTarget","dataset"],"mappings":"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","sourcesContent":["import { compose } from \"./middleware.js\";\n\nconst defaults = {\n  fetchOptions: {\n    method: 'GET',\n    headers: {\n      'Accept': 'application/json',\n      'Content-Type': 'application/json'\n    }\n  },\n  buildResponse: function (res) {\n    if (res && res.json) {\n      return res.json().then((dataOrError) => {\n        if (res.ok) {\n          return dataOrError;\n        } else {\n          throw dataOrError;\n        }\n      });\n    } else {\n      return {};\n    }\n  }\n};\n\nconst fetchInitKeys = ['method', 'headers', 'body', 'mode', 'credentials', 'cache', 'redirect', 'referrer', 'referrerPolicy', 'integrity'];\n\nfunction omitChildren(obj) {\n  const { children, ...rest } = obj;\n  return rest;\n}\n\nfunction buildQuery(params) {\n  let esc = encodeURIComponent;\n  return Object.keys(params)\n    .map(k => {\n      if (Array.isArray(params[k])) {\n        let key = k;\n        let items = params[k].map(item => {\n          return esc(key + '[]') + '=' + esc(item);\n        });\n        return items.join('&');\n      } else {\n        return esc(k) + '=' + esc(params[k]);\n      }\n    })\n    .join('&');\n}\n\nfunction filterOptions(options) {\n  return Object.keys(options).reduce((data, key) => {\n    if (fetchInitKeys.indexOf(key) !== -1) {\n      data[key] = options[key];\n    }\n    return data;\n  }, {});\n}\n\nfunction getTopFetch() {\n  let topFetch;\n  if (typeof window !== 'undefined') {\n    if (window.fetch) {\n      topFetch = window.fetch.bind(window);\n    }\n  } else if (typeof global !== 'undefined') {\n    if (global.fetch) {\n      topFetch = global.fetch.bind(global);\n    }\n  } else if (typeof self !== 'undefined') {\n    if (self.fetch) {\n      topFetch = self.fetch.bind(self);\n    }\n  }\n  return topFetch;\n}\n\nfunction buildFetch(url, options = {}) {\n  let topFetch = getTopFetch();\n  let { params = {}, isForm, ...otherOptions } = options;\n  otherOptions = filterOptions(otherOptions);\n  let { host, ...fetchOptions } = defaults.fetchOptions;\n  if (!url.match(/https?:\\/\\//) && host) {\n    url = host + url;\n  }\n  otherOptions.headers = Object.assign({}, options.headers || {}, fetchOptions.headers);\n  otherOptions.method = options.method || fetchOptions.method;\n  let globalParams = fetchOptions.globalParams ? fetchOptions.globalParams : {};\n  params = Object.assign({}, params, globalParams);\n  if (otherOptions.method === 'GET') {\n    let query = buildQuery(params);\n    if (query) {\n      if (url.match(/https?:\\/\\/.*\\?/)) {\n        url = url + '&' + buildQuery(params);\n      } else {\n        url = url + '?' + buildQuery(params);\n      }\n    }\n  } else if (otherOptions.method === 'POST' && !otherOptions.body) {\n    if (otherOptions.transformFormData)\n      if (isForm) {\n        let formData = new FormData();\n        Object.keys(params).forEach(key => {\n          formData.append(key, params[key]);\n        });\n        otherOptions.body = formData;\n      } else {\n        // default transform json\n        otherOptions.body = JSON.stringify(params);\n      }\n  }\n  return topFetch(url, otherOptions).then((res) => {\n    return defaults.buildResponse(res);\n  });\n}\n\nfunction initConfig({ options = {}, mapResponse }) {\n  if (typeof options === 'object') {\n    defaults.fetchOptions = Object.assign(defaults.fetchOptions, options);\n  }\n  if (Function.prototype.isPrototypeOf(mapResponse)) {\n    defaults.buildResponse = mapResponse;\n  }\n}\n\nfunction bindDomClick(func, verification) {\n  return function (event) {\n    // get params from event\n    let params = {};\n    if (event && event.currentTarget) {\n      let dataset = event.currentTarget.dataset || {};\n      params = {\n        ...dataset\n      };\n    }\n    if (verification) {\n      if (typeof verification === 'function') {\n        if (!verification(params)) return;\n      } else {\n        return;\n      }\n    }\n    return func(params);\n  };\n}\n\nexport {\n  omitChildren,\n  buildFetch,\n  initConfig,\n  bindDomClick\n};\n"],"file":"helper.js"}