{"version":3,"sources":["../../src/hooks/useRequest.js"],"names":["useRequest","fn","deps","initialState","lastCallId","state","isMounted","callback","callId","current","promise","status","loading","cancel","then","value","error","FetchError"],"mappings":";;;;;;;AAAA;;AACA;;AACA;;;;AAEe,SAASA,UAAT,CAAoBC,EAApB,EAAiD;AAAA,MAAzBC,IAAyB,uEAAlB,EAAkB;AAAA,MAAdC,YAAc;AAC9D,MAAMC,UAAU,GAAG,mBAAO,CAAP,CAAnB;AACA,MAAMC,KAAK,GAAG,mBAAOF,YAAP,CAAd;AACA,MAAMG,SAAS,GAAG,kCAAlB;AAEA,MAAMC,QAAQ,GAAG,wBAAY,YAAa;AACxC,QAAMC,MAAM,GAAG,EAAEJ,UAAU,CAACK,OAA5B;AACA,QAAIC,OAAO,GAAGT,EAAE,MAAF,mBAAd;AACAI,IAAAA,KAAK,CAACI,OAAN,GAAgB;AACdE,MAAAA,MAAM,EAAE,SADM;AAEdC,MAAAA,OAAO,EAAE,IAFK;AAGdC,MAAAA,MAAM,EAAEH,OAAO,CAACG;AAHF,KAAhB;AAKA,WAAOH,OAAO,CAACI,IAAR,CACL,UAAAC,KAAK,EAAI;AACP,UAAIT,SAAS,MAAME,MAAM,KAAKJ,UAAU,CAACK,OAAzC,EAAkD;AAChDJ,QAAAA,KAAK,CAACI,OAAN,GAAgBM,KAAhB;AACD;;AACD,aAAOA,KAAK,CAACA,KAAb;AACD,KANI,EAOL,UAAAC,KAAK,EAAI;AACP,UAAIV,SAAS,MAAME,MAAM,KAAKJ,UAAU,CAACK,OAAzC,EAAkD;AAChDJ,QAAAA,KAAK,CAACI,OAAN,GAAgBO,KAAhB;AACD;;AACD,YAAM,IAAIC,kBAAJ,CAAeD,KAAf,CAAN;AACD,KAZI,CAAP;AAcD,GAtBgB,EAsBdd,IAtBc,CAAjB;AAwBA,SAAO,CAACG,KAAK,CAACI,OAAP,EAAgBF,QAAhB,CAAP;AACD","sourcesContent":["import { useCallback, useRef } from 'react';\nimport useMountedState from './useMountedState';\nimport { FetchError } from '../utils/helper';\n\nexport default function useRequest(fn, deps = [], initialState) {\n  const lastCallId = useRef(0);\n  const state = useRef(initialState);\n  const isMounted = useMountedState();\n\n  const callback = useCallback((...args) => {\n    const callId = ++lastCallId.current;\n    let promise = fn(...args);\n    state.current = {\n      status: 'loading',\n      loading: true,\n      cancel: promise.cancel\n    };\n    return promise.then(\n      value => {\n        if (isMounted() && callId === lastCallId.current) {\n          state.current = value;\n        }\n        return value.value;\n      },\n      error => {\n        if (isMounted() && callId === lastCallId.current) {\n          state.current = error;\n        }\n        throw new FetchError(error);\n      }\n    );\n  }, deps);\n\n  return [state.current, callback];\n}\n"],"file":"useRequest.js"}